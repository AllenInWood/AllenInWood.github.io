<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>The implementation of B+ tree printing | AllenInWood&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="BACKGROUND The B+ tree is a kind of Balanced tree which is used to manipulate indexes saving in the relational database system. By using B+ tree, it is faster to retrieve targetted record in the heap">
<meta name="keywords" content="C++,B+tree,BFS">
<meta property="og:type" content="article">
<meta property="og:title" content="The implementation of B+ tree printing">
<meta property="og:url" content="https://alleninwood.github.io/2017/11/21/The-implementation-of-B-tree-printing/index.html">
<meta property="og:site_name" content="AllenInWood&#39;s Blog">
<meta property="og:description" content="BACKGROUND The B+ tree is a kind of Balanced tree which is used to manipulate indexes saving in the relational database system. By using B+ tree, it is faster to retrieve targetted record in the heap">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://alleninwood.github.io/images/tree3.svg">
<meta property="og:image" content="https://alleninwood.github.io/images/serializeTree.png">
<meta property="og:updated_time" content="2017-11-23T07:24:35.127Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The implementation of B+ tree printing">
<meta name="twitter:description" content="BACKGROUND The B+ tree is a kind of Balanced tree which is used to manipulate indexes saving in the relational database system. By using B+ tree, it is faster to retrieve targetted record in the heap">
<meta name="twitter:image" content="https://alleninwood.github.io/images/tree3.svg">
  
    <link rel="alternate" href="/atom.xml" title="AllenInWood&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">AllenInWood&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">WritingAndCoding</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://alleninwood.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-The-implementation-of-B-tree-printing" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/21/The-implementation-of-B-tree-printing/" class="article-date">
  <time datetime="2017-11-21T08:28:39.000Z" itemprop="datePublished">2017-11-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/code/">code</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      The implementation of B+ tree printing
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="BACKGROUND"><a href="#BACKGROUND" class="headerlink" title="BACKGROUND"></a>BACKGROUND</h2><hr>
<p>The B+ tree is a kind of Balanced tree which is used to manipulate indexes saving in the relational database system. By using B+ tree, it is faster to retrieve targetted record in the heap file.<br>In this essay, let me introduce the recent implementation of printing B+ tree in one of my current project.</p>
<p>As usual, B+ has a low level and multiple fanout number, and its non-leaf has a different structure from leaf node. In database lower layer, non-leaf contains multiple keys to search for different leaves. And leaf node contains real key value and RID of record (can be used to get record from heap file).</p>
<h2 id="Analyse"><a href="#Analyse" class="headerlink" title="Analyse"></a>Analyse</h2><hr>
<p>In normal situation, B+ tree has a printing structure as below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"keys"</span>:[<span class="string">"P"</span>],</span><br><span class="line"><span class="string">"children"</span>:[</span><br><span class="line">    &#123;<span class="string">"keys"</span>:[<span class="string">"C"</span>,<span class="string">"G"</span>,<span class="string">"M"</span>],</span><br><span class="line">     <span class="string">"children"</span>: [</span><br><span class="line">        &#123;<span class="string">"keys"</span>: [<span class="string">"A:[(1,1),(1,2)]"</span>,<span class="string">"B:[(2,1),(2,2)]"</span>]&#125;,</span><br><span class="line">        &#123;<span class="string">"keys"</span>: [<span class="string">"D:[(3,1),(3,2)]"</span>,<span class="string">"E:[(4,1)]"</span>,<span class="string">"F:[(5,1)]"</span>]&#125;,</span><br><span class="line">        &#123;<span class="string">"keys"</span>: [<span class="string">"J:[(5,1),(5,2)]"</span>,<span class="string">"K:[(6,1),(6,2)]"</span>,<span class="string">"L:[(7,1)]"</span>]&#125;,</span><br><span class="line">        &#123;<span class="string">"keys"</span>: [<span class="string">"N:[(8,1)]"</span>,<span class="string">"O:[(9,1)]"</span>]&#125;</span><br><span class="line">    ]&#125;,</span><br><span class="line">    &#123;<span class="string">"keys"</span>:[<span class="string">"T"</span>,<span class="string">"X"</span>],</span><br><span class="line">     <span class="string">"children"</span>: [</span><br><span class="line">        &#123;<span class="string">"keys"</span>: [<span class="string">"Q:[(10,1)]"</span>,<span class="string">"R:[(11,1)]"</span>,<span class="string">"S:[(12,1)]"</span>]&#125;,</span><br><span class="line">        &#123;<span class="string">"keys"</span>: [<span class="string">"U:[(13,1)]"</span>,<span class="string">"V:[(14,1)]"</span>]&#125;,</span><br><span class="line">        &#123;<span class="string">"keys"</span>: [<span class="string">"Y:[(15,1)]"</span>,<span class="string">"Z:[(16,1)]"</span>]&#125;</span><br><span class="line">    ]&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Its tree-formatted structure is like below</p>
<p><img src="/images/tree3.svg" alt=""></p>
<p>We could see from what we mentioned, the non-leaf of B+ tree has “keys” and “children”, but the leaf only has “keys”.<br>So the printing of leaf and non-leaf is different, we could use different situation in our BFS Algorithm.<br>Further, The end of each printing component doesn’t have ‘,’. About this problem, we print the first one in the beginning, then print “,” + left one iteratively.</p>
<p>In a corner case, only one leaf node and each entry has same key value, i. e. if leaf entries contain duplicate values, there’s no duplicate key printing anymore, and the RID of it should be in the same quotation marks of former one’s. I designed a way to avoid this problem : remember the former keys when handling leaves, and forget them in the suitable time.</p>
<a id="more"></a>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><hr>
<p>The code is below, I use a DFS recursive way to print the entire tree. For the short height of B+ tree, my recursive way cannot lead to the overflow of heap. My code is in the following.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">void IndexManager::printBtree(IXFileHandle &amp;ixfileHandle, const Attribute &amp;attribute) const &#123;</span><br><span class="line">	int rootPage;</span><br><span class="line">	ixfileHandle.fileHandle.readRoot(rootPage);</span><br><span class="line">	void *memory = malloc(PAGE_SIZE);</span><br><span class="line">	ixfileHandle.readPage(rootPage, memory);</span><br><span class="line">	unsigned page = (unsigned) rootPage;</span><br><span class="line">	string ans = serializeTree(ixfileHandle, attribute.type, page, memory);</span><br><span class="line">	cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">	memset(memory, 0, PAGE_SIZE);</span><br><span class="line">	free(memory);</span><br><span class="line">	<span class="built_in">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">string IndexManager::serializeTree(IXFileHandle &amp;ixfileHandle, const AttrType <span class="built_in">type</span>, PageNum root, void *memory) const &#123;</span><br><span class="line">  int numberOfNodes = *(short int *)((char *)memory + 1);</span><br><span class="line">  char leafIndicator = *(char *)memory;</span><br><span class="line">  int index;</span><br><span class="line">  string s = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">if</span> (numberOfNodes == 0) &#123;</span><br><span class="line">  	<span class="built_in">return</span> <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (leafIndicator == <span class="string">'0'</span>) &#123;</span><br><span class="line">    s += <span class="string">"&#123;\"keys\":["</span>;</span><br><span class="line">    int offset = 5;</span><br><span class="line">    // int branch : length = 4, point = 2</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">type</span> == TypeInt) &#123;</span><br><span class="line">      int tempKey = *(int *)((char *)memory + offset + 4);</span><br><span class="line">      s += <span class="string">"\""</span> + to_string(tempKey) + <span class="string">"\""</span>;</span><br><span class="line">      <span class="keyword">for</span> (index = 1; index &lt; numberOfNodes; index++) &#123;</span><br><span class="line">		tempKey = *(int *)((char *)memory + offset + 4 + 8 * index);</span><br><span class="line">		s += <span class="string">",\""</span> + to_string(tempKey) + <span class="string">"\""</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      s += <span class="string">"],\"children\":["</span>;</span><br><span class="line">      void *tempPage = malloc(PAGE_SIZE);</span><br><span class="line">      PageNum tempPageNum = *(unsigned *)((char *)memory + offset);</span><br><span class="line">      ixfileHandle.readPage(tempPageNum, tempPage);</span><br><span class="line">      s += serializeTree(ixfileHandle, <span class="built_in">type</span>, tempPageNum, tempPage);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (index = 0; index &lt; numberOfNodes; index++) &#123;</span><br><span class="line">        tempPageNum = *(unsigned *)((char *)memory + offset + 8 * (1 + index));</span><br><span class="line">        ixfileHandle.readPage(tempPageNum, tempPage);</span><br><span class="line">        s += <span class="string">","</span>;</span><br><span class="line">        s += serializeTree(ixfileHandle, <span class="built_in">type</span>, tempPageNum, tempPage);</span><br><span class="line">      &#125;</span><br><span class="line">      s += <span class="string">"]&#125;"</span>;</span><br><span class="line">      free(tempPage);</span><br><span class="line">    &#125;</span><br><span class="line">    // <span class="built_in">float</span> branch : length = 4, point = 2</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">type</span> == TypeReal) &#123;</span><br><span class="line">      int tempKey = *(<span class="built_in">float</span> *)((char *)memory + offset + 4);</span><br><span class="line">      s += <span class="string">"\""</span> + to_string(tempKey) + <span class="string">"\""</span>;</span><br><span class="line">      <span class="keyword">for</span> (index = 1; index &lt; numberOfNodes; index++) &#123;</span><br><span class="line">        tempKey = *(<span class="built_in">float</span> *)((char *)memory + offset + 4 + 8 * index);</span><br><span class="line">        s += <span class="string">",\""</span> + to_string(tempKey) + <span class="string">"\""</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      s += <span class="string">"],\"children\":["</span>;</span><br><span class="line">      void *tempPage = malloc(PAGE_SIZE);</span><br><span class="line">      PageNum tempPageNum = *(unsigned *)((char *)memory + offset);</span><br><span class="line">      ixfileHandle.readPage(tempPageNum, tempPage);</span><br><span class="line">      s += serializeTree(ixfileHandle, <span class="built_in">type</span>, tempPageNum, tempPage);</span><br><span class="line">      <span class="keyword">for</span> (index = 0; index &lt; numberOfNodes; index++) &#123;</span><br><span class="line">        tempPageNum = *(unsigned *)((char *)memory + offset + 8 * (1 + index));////</span><br><span class="line">        ixfileHandle.readPage(tempPageNum, tempPage);</span><br><span class="line">        s += <span class="string">","</span>;</span><br><span class="line">        s += serializeTree(ixfileHandle, <span class="built_in">type</span>, tempPageNum, tempPage);</span><br><span class="line">      &#125;</span><br><span class="line">      s += <span class="string">"]&#125;"</span>;</span><br><span class="line">      free(tempPage);</span><br><span class="line">    &#125;</span><br><span class="line">    // varchar branch</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      //use varchar directory to calculate the length of each element</span><br><span class="line">      string tempKey = <span class="string">""</span>;</span><br><span class="line">      short int tailOffset = *(short int *)((char *)memory + PAGE_SIZE - 2);</span><br><span class="line">      int varcharLength = tailOffset - offset - 4;</span><br><span class="line">      <span class="keyword">for</span> (int i = 0; i &lt; varcharLength; i++) &#123;</span><br><span class="line">				char ch = *((char *)memory + offset + 4 + i);</span><br><span class="line">				tempKey += ch;</span><br><span class="line">			&#125;</span><br><span class="line">      s += <span class="string">"\""</span> + tempKey + <span class="string">"\""</span>;</span><br><span class="line">      <span class="keyword">for</span> (index = 1; index &lt; numberOfNodes; index++) &#123;</span><br><span class="line">        tempKey = <span class="string">""</span>;</span><br><span class="line">        tailOffset = *(short int *)((char *)memory + PAGE_SIZE - 2 * (index + 1));</span><br><span class="line">        varcharLength = tailOffset - *(short int *)((char *)memory + PAGE_SIZE - 2 * index) - 4;</span><br><span class="line">        <span class="keyword">for</span> (int i = 0; i &lt; varcharLength; i++) &#123;</span><br><span class="line">  				char ch = *((char *)memory + *(short int *)((char *)memory + PAGE_SIZE - 2 * index) + 4 + i);</span><br><span class="line">  				tempKey += ch;</span><br><span class="line">  			&#125;</span><br><span class="line">        s += <span class="string">",\""</span> + tempKey + <span class="string">"\""</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      s += <span class="string">"],\"children\":["</span>;</span><br><span class="line">      void *tempPage = malloc(PAGE_SIZE);</span><br><span class="line">      PageNum tempPageNum = *(unsigned *)((char *)memory + offset);</span><br><span class="line">      ixfileHandle.readPage(tempPageNum, tempPage);</span><br><span class="line">      s += serializeTree(ixfileHandle, <span class="built_in">type</span>, tempPageNum, tempPage);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (index = 0; index &lt; numberOfNodes; index++) &#123;</span><br><span class="line">        tailOffset = *(short int *)((char *)memory + PAGE_SIZE - 2 * (index + 1));</span><br><span class="line">        tempPageNum = *(unsigned *)((char *)memory + tailOffset);</span><br><span class="line">        ixfileHandle.readPage(tempPageNum, tempPage);</span><br><span class="line">        s += <span class="string">","</span>;</span><br><span class="line">        s += serializeTree(ixfileHandle, <span class="built_in">type</span>, tempPageNum, tempPage);</span><br><span class="line">      &#125;</span><br><span class="line">      s += <span class="string">"]&#125;"</span>;</span><br><span class="line">      free(tempPage);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  //<span class="keyword">for</span> the Leaf node</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    s += <span class="string">"&#123;\"keys\":["</span>;</span><br><span class="line">    int offset = 5;</span><br><span class="line">    index = 0;</span><br><span class="line">    //Int branch : Key length = 4 bytes, RID = 4 bytes</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">type</span> == TypeInt) &#123;</span><br><span class="line">      //handle the first one, no <span class="string">","</span></span><br><span class="line">      int tempKey = *(int *)((char *)memory + offset);</span><br><span class="line">      RID tempRID;</span><br><span class="line">      tempRID.pageNum = *(unsigned *)((char *)memory + offset + 4);</span><br><span class="line">      tempRID.slotNum = *(unsigned *)((char *)memory + offset + 8);</span><br><span class="line">      index = 1;</span><br><span class="line">      s += <span class="string">"\""</span> + to_string(tempKey) + <span class="string">":[("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">      int before = tempKey;</span><br><span class="line">      <span class="keyword">for</span> (; index &lt; numberOfNodes;) &#123;</span><br><span class="line">        tempKey = *(int *)((char *)memory + offset + 12 * index);</span><br><span class="line">        <span class="keyword">if</span> (tempKey == before) &#123;</span><br><span class="line">          tempRID.pageNum = *(unsigned *)((char *)memory + offset + 12 * index + 4);</span><br><span class="line">          tempRID.slotNum = *(unsigned *)((char *)memory + offset + 12 * index + 8);</span><br><span class="line">          index++;</span><br><span class="line">          s += <span class="string">",("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      //handle the rest elements <span class="built_in">which</span> have a <span class="string">","</span> <span class="keyword">in</span> the beginning part</span><br><span class="line">      <span class="keyword">while</span> (index &lt; numberOfNodes) &#123;</span><br><span class="line">        int tempKey = *(int *)((char *)memory + offset + 12 * index);</span><br><span class="line">        tempRID.pageNum = *(unsigned *)((char *)memory + offset + 12 * index + 4);</span><br><span class="line">        tempRID.slotNum = *(unsigned *)((char *)memory + offset + 12 * index + 8);</span><br><span class="line">        <span class="keyword">if</span> (tempKey != before) &#123;</span><br><span class="line">          s += <span class="string">"]\",\""</span> + to_string(tempKey) + <span class="string">":[("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">          before = tempKey;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          s += <span class="string">",("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        index++;</span><br><span class="line">      &#125;</span><br><span class="line">      s += <span class="string">"]\"]&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">type</span> == TypeReal) &#123;</span><br><span class="line">      //handle the first one, no <span class="string">","</span></span><br><span class="line">      int tempKey = *(<span class="built_in">float</span> *)((char *)memory + offset);</span><br><span class="line">      RID tempRID;</span><br><span class="line">      tempRID.pageNum = *(unsigned *)((char *)memory + offset + 4);</span><br><span class="line">      tempRID.slotNum = *(unsigned *)((char *)memory + offset + 8);</span><br><span class="line">      index = 1;</span><br><span class="line">      s += <span class="string">"\""</span> + to_string(tempKey) + <span class="string">":[("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">      int before = tempKey;</span><br><span class="line">      <span class="keyword">for</span> (; index &lt; numberOfNodes;) &#123;</span><br><span class="line">        tempKey = *(<span class="built_in">float</span> *)((char *)memory + offset + 12 * index);</span><br><span class="line">        <span class="keyword">if</span> (tempKey == before) &#123;</span><br><span class="line">          tempRID.pageNum = *(unsigned *)((char *)memory + offset + 12 * index + 4);</span><br><span class="line">          tempRID.slotNum = *(unsigned *)((char *)memory + offset + 12 * index + 8);</span><br><span class="line">          index++;</span><br><span class="line">          s += <span class="string">",("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      //handle the rest elements <span class="built_in">which</span> have a <span class="string">","</span> <span class="keyword">in</span> the beginning part</span><br><span class="line">      <span class="keyword">while</span> (index &lt; numberOfNodes) &#123;</span><br><span class="line">        int tempKey = *(<span class="built_in">float</span> *)((char *)memory + offset + 12 * index);</span><br><span class="line">        tempRID.pageNum = *(unsigned *)((char *)memory + offset + 8 * index + 4);</span><br><span class="line">        tempRID.slotNum = *(unsigned *)((char *)memory + offset + 8 * index + 8);</span><br><span class="line">        <span class="keyword">if</span> (tempKey != before) &#123;</span><br><span class="line">          s += <span class="string">"]\",\""</span> + to_string(tempKey) + <span class="string">":[("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">          before = tempKey;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          s += <span class="string">",("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        index++;</span><br><span class="line">      &#125;</span><br><span class="line">      s += <span class="string">"]\"]&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    //varchar situation</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      //handle the first one, no <span class="string">","</span></span><br><span class="line">      string tempKey = <span class="string">""</span>;</span><br><span class="line">      short int tailOffset = *(short int *)((char *)memory + PAGE_SIZE - 6);</span><br><span class="line">      int varcharLength = tailOffset - offset - 8;</span><br><span class="line">      <span class="keyword">for</span> (int i = 0; i &lt; varcharLength; i++) &#123;</span><br><span class="line">				char ch = *((char *)memory + offset + i);</span><br><span class="line">				tempKey += ch;</span><br><span class="line">	  &#125;</span><br><span class="line">      RID tempRID;</span><br><span class="line">      tempRID.pageNum = *(unsigned *)((char *)memory + tailOffset - 8);</span><br><span class="line">      tempRID.slotNum = *(unsigned *)((char *)memory + tailOffset - 4);</span><br><span class="line">      index = 1;</span><br><span class="line">      s += <span class="string">"\""</span> + tempKey + <span class="string">":[("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">      string before = tempKey;</span><br><span class="line">      <span class="keyword">for</span> (; index &lt; numberOfNodes;) &#123;</span><br><span class="line">        tailOffset = *(short int *)((char *)memory + PAGE_SIZE - 4 - 2 * (index + 1));</span><br><span class="line">        varcharLength = tailOffset - *(short int *)((char *)memory + PAGE_SIZE - 4 - 2 * index) - 8;</span><br><span class="line">        <span class="keyword">for</span> (int i = 0; i &lt; varcharLength; i++) &#123;</span><br><span class="line">  				char ch = *((char *)memory + tailOffset - varcharLength - 8 + i);</span><br><span class="line">  				tempKey += ch;</span><br><span class="line">  		&#125;</span><br><span class="line">        //tempKey = *(int *)((char *)memory + offset + 8 * index);</span><br><span class="line">        <span class="keyword">if</span> (tempKey == before) &#123;</span><br><span class="line">          tempRID.pageNum = *(unsigned *)((char *)memory + tailOffset - 8);</span><br><span class="line">          tempRID.slotNum = *(unsigned *)((char *)memory + tailOffset - 4);</span><br><span class="line">          index++;</span><br><span class="line">          s += <span class="string">",("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      //handle the rest elements <span class="built_in">which</span> have a <span class="string">","</span> <span class="keyword">in</span> the beginning part</span><br><span class="line">      <span class="keyword">while</span> (index &lt; numberOfNodes) &#123;</span><br><span class="line">        tempKey = <span class="string">""</span>;</span><br><span class="line">        tailOffset = *(short int *)((char *)memory + PAGE_SIZE - 4 - 2 * (index + 1));</span><br><span class="line">        varcharLength = tailOffset - *(short int *)((char *)memory + PAGE_SIZE - 4 - 2 * index) - 8;</span><br><span class="line">        <span class="keyword">for</span> (int i = 0; i &lt; varcharLength; i++) &#123;</span><br><span class="line">          char ch = *((char *)memory + tailOffset - varcharLength - 8 + i);</span><br><span class="line">          tempKey += ch;</span><br><span class="line">        &#125;</span><br><span class="line">        tempRID.pageNum = *(unsigned *)((char *)memory + tailOffset - 8);</span><br><span class="line">        tempRID.slotNum = *(unsigned *)((char *)memory + tailOffset - 4);</span><br><span class="line">        <span class="keyword">if</span> (tempKey != before) &#123;</span><br><span class="line">          s += <span class="string">"]\",\""</span> + tempKey + <span class="string">":[("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">          before = tempKey;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          s += <span class="string">",("</span> + to_string(tempRID.pageNum) + <span class="string">","</span> + to_string(tempRID.slotNum) + <span class="string">")"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        index++;</span><br><span class="line">      &#125;</span><br><span class="line">      s += <span class="string">"]\"]&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The Thought line of the above code is drew in the following picture:<br><img src="/images/serializeTree.png" alt=""><br>As for the third situation, it has multiple adjacent leaf node, picture like below :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"keys"</span>:[<span class="string">"00000:[(87,0),(84,0),(81,0),(78,0),(75,0),(72,0),(69,0),(66,0),(63,0),(60,0),(57,0),(54,0),(51,0),(48,0),(45,0),(42,0),(39,0),(36,0),(33,0),(30,0),(27,0),(24,0),(21,0),(18,0),(15,0),(12,0),(9,0),(6,0),(3,0),(0,0)]"</span>,<span class="string">"00001:[(88,1),(85,1),(82,1),(79,1),(76,1),(73,1),(70,1),(67,1),(64,1),(61,1),(58,1),(55,1),(52,1),(49,1),(46,1),(43,1),(40,1),(37,1),(34,1),(31,1),(28,1),(25,1),(22,1),(19,1),(16,1),(13,1),(10,1),(7,1),(4,1),(1,1)]"</span>,<span class="string">"00002:[(89,2),(86,2),(83,2),(80,2),(77,2),(74,2),(71,2),(68,2),(65,2),(62,2),(59,2),(56,2),(53,2),(50,2),(47,2),(44,2),(41,2),(38,2),(35,2),(32,2),(29,2),(26,2),(23,2),(20,2),(17,2),(14,2),(11,2),(8,2),(5,2),(2,2)]"</span>]&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference :"></a>Reference :</h2><hr>
<p>Database Management System, third edition, Ramakrishnan Gehrke, 2003.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alleninwood.github.io/2017/11/21/The-implementation-of-B-tree-printing/" data-id="cjfqcb74o00146uzizsiglvkc" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/B-tree/">B+tree</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BFS/">BFS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C++</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/12/01/The-principle-of-Java-TreeMap/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Récent</strong>
      <div class="article-nav-title">
        
          The principle of Java TreeMap
        
      </div>
    </a>
  
  
    <a href="/2017/11/11/Springboot-Restful-API-summary/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Ancien</strong>
      <div class="article-nav-title">Springboot Restful API summary</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Catégories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/chatting/">chatting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/code/">code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/essay/">essay</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-clés</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/B-tree/">B+tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BFS/">BFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HashMap/">HashMap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HashSet/">HashSet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PriorityQueue/">PriorityQueue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Springmvc/">Springmvc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TreeMap/">TreeMap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/comeback/">comeback</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/config/">config</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dispersion-plot/">dispersion_plot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/generate/">generate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/night/">night</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nltk/">nltk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rain/">rain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/restful/">restful</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unicode/">unicode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/version/">version</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/堆/">堆</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nuage de mot-clés</h3>
    <div class="widget tagcloud">
      <a href="/tags/B-tree/" style="font-size: 10px;">B+tree</a> <a href="/tags/BFS/" style="font-size: 10px;">BFS</a> <a href="/tags/C/" style="font-size: 10px;">C++</a> <a href="/tags/HashMap/" style="font-size: 10px;">HashMap</a> <a href="/tags/HashSet/" style="font-size: 13.33px;">HashSet</a> <a href="/tags/Java/" style="font-size: 13.33px;">Java</a> <a href="/tags/PriorityQueue/" style="font-size: 10px;">PriorityQueue</a> <a href="/tags/Spring/" style="font-size: 10px;">Spring</a> <a href="/tags/Springmvc/" style="font-size: 10px;">Springmvc</a> <a href="/tags/TreeMap/" style="font-size: 10px;">TreeMap</a> <a href="/tags/comeback/" style="font-size: 10px;">comeback</a> <a href="/tags/config/" style="font-size: 10px;">config</a> <a href="/tags/dispersion-plot/" style="font-size: 10px;">dispersion_plot</a> <a href="/tags/generate/" style="font-size: 10px;">generate</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/night/" style="font-size: 10px;">night</a> <a href="/tags/nltk/" style="font-size: 16.67px;">nltk</a> <a href="/tags/python/" style="font-size: 16.67px;">python</a> <a href="/tags/rain/" style="font-size: 10px;">rain</a> <a href="/tags/restful/" style="font-size: 10px;">restful</a> <a href="/tags/springboot/" style="font-size: 10px;">springboot</a> <a href="/tags/unicode/" style="font-size: 10px;">unicode</a> <a href="/tags/version/" style="font-size: 10px;">version</a> <a href="/tags/堆/" style="font-size: 10px;">堆</a> <a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/03/07/HashMap-Internal-Principle-and-Implementation/">HashMap Internal Principle and Implementation</a>
          </li>
        
          <li>
            <a href="/2017/12/16/PriorityQueue-in-Java/">PriorityQueue in Java</a>
          </li>
        
          <li>
            <a href="/2017/12/01/The-principle-of-Java-TreeMap/">The principle of Java TreeMap</a>
          </li>
        
          <li>
            <a href="/2017/11/21/The-implementation-of-B-tree-printing/">The implementation of B+ tree printing</a>
          </li>
        
          <li>
            <a href="/2017/11/11/Springboot-Restful-API-summary/">Springboot Restful API summary</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 AllenInWood<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>